"use strict";(()=>{var o="stats",a=`https://cmsep-backend.mondopower.com.au/${townName}.json`,n=1*60*1e3;document.addEventListener("alpine:init",()=>{window.Alpine.data(o,function(){return{townName:"",lastUpdated:dayjs().tz().fromNow(),numberOfSystems:"",isExporting:!1,isPreStormResilience:!1,isResilience:!1,gridExportCount:"",isGridConnected:!1,isIslanded:!1,solarGenerating:"",solarCapacity:"",solarGeneratingPercent:0,batteryChargeState:"",batteryCapacity:"",batteryChargePercent:0,isError:!1,init(){this.queryData(),this.initPolling()},async queryData(){try{let e=await(await fetch(a)).json();this.isError=!1,console.debug("API Data fetched",e),this.townName=e.townName,this.lastUpdated=dayjs().tz().to(e.timestamp),this.numberOfSystems=e.numberOfSystems.toString(),this.isExporting=e.status==="Exporting",this.isPreStormResilience=e.status==="Pre-event resilience mode \u2013 charging",this.isResilience=e.status==="Resilience mode \u2013 conserve energy",this.gridExportCount=e.exportingToGrid.value+e.exportingToGrid.unit,this.isGridConnected=e.townSupplyStatus==="Grid connected",this.isIslanded=e.townSupplyStatus==="Islanded",this.solarGenerating=e.solar.generating.value+e.solar.generating.unit,this.solarCapacity=e.solar.capacity.value+e.solar.capacity.unit,this.solarGeneratingPercent=e.solar.generating.value/e.solar.capacity.value*100,this.batteryChargeState=e.batteries.stateOfCharge.value+e.batteries.stateOfCharge.unit,this.batteryCapacity=e.batteries.capacity.value+e.batteries.capacity.unit,this.batteryChargePercent=e.batteries.stateOfCharge.value}catch(t){this.isError=!0,console.error("Error in fetching the data",t)}},initPolling(){try{setInterval(()=>{this.queryData()},n)}catch(t){this.isError=!0,console.error("Error in polling the data",t)}},showPopover(){let t=this.$el.querySelector("[popover]");if(t){if(window.innerWidth>991){let{top:e,left:r}=this.$el.getBoundingClientRect(),i=e,s=r-600;Object.assign(t.style,{left:`${s}px`,top:`${i}px`})}t.showPopover()}},hidePopover(){var t,e;this.$el.getAttribute("x-ref")==="popoverCloseIcon"?(t=this.$el.closest("[popover]"))==null||t.hidePopover():(e=this.$el.querySelector("[popover]"))==null||e.hidePopover()}}})});})();
